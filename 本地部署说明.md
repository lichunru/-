# 中医智能康养管理系统 (TCMWR) - 本地部署说明

## 📋 概述

本文档提供中医智能康养管理系统的完整本地部署指南。系统采用前后端分离架构，基于 **Spring Boot 3.5.9** + **Vue.js 3** + **MySQL 8.0** 构建。

**系统版本**: v1.0.0  
**最后更新**: 2026-01-15

---

## 🎯 系统架构

### 技术栈
- **后端**: Spring Boot 3.5.9 + MyBatis + MySQL 8.0
- **前端**: Vue.js 3 + Vite + Element Plus
- **缓存**: Redis 6.0+
- **认证**: JWT
- **AI集成**: DeepSeek API

### 服务端口
- **后端API**: http://localhost:8082/api
- **前端服务**: http://localhost:5173/
- **Redis**: localhost:6379

---

## 🔧 环境要求

### 必需组件
| 组件 | 版本要求 | 用途 |
|------|----------|------|
| JDK | 17+ | Java运行环境 |
| Node.js | 18+ | 前端开发环境 |
| MySQL | 8.0+ | 主数据库 |
| Redis | 6.0+ | 缓存服务 |
| Maven | 3.6+ | 项目构建工具 |

### 可选组件
- **Git**: 代码版本控制
- **Postman**: API接口测试
- **Redis Desktop Manager**: Redis可视化管理

---

## 📦 项目结构

```
TCMWR/
├── backend/                    # 后端代码
│   ├── src/main/java/com/tcmwr/
│   │   ├── config/            # 配置类
│   │   ├── controller/        # 控制器
│   │   ├── service/           # 业务逻辑
│   │   ├── entity/            # 实体类
│   │   ├── mapper/            # 数据访问
│   │   └── utils/             # 工具类
│   ├── src/main/resources/    # 资源文件
│   │   ├── application.yml    # 主配置
│   │   ├── schema.sql         # 表结构
│   │   └── data.sql           # 测试数据
│   ├── pom.xml                # Maven配置
│   └── target/                # 编译输出
├── frontend/                  # 前端代码
│   ├── src/
│   │   ├── api/              # API接口
│   │   ├── store/            # 状态管理
│   │   ├── router/           # 路由配置
│   │   ├── utils/            # 工具类
│   │   └── views/            # 页面组件
│   ├── package.json          # 依赖配置
│   └── vite.config.js        # 构建配置
└── 本地部署说明.md            # 本文档
```

---

## 🚀 部署步骤

### 第一步：环境准备

#### 1. 安装JDK 17
```bash
# Windows (使用Chocolatey)
choco install openjdk17

# 验证安装
java -version
# 应显示: openjdk version "17.x.x"
```

#### 2. 安装Node.js 18+
```bash
# 下载安装包: https://nodejs.org/zh-cn/download/
# 选择 LTS 版本 (18.x 或更高)

# 验证安装
node -v  # 应显示: v18.x.x 或更高
npm -v   # 应显示: 9.x.x 或更高
```

#### 3. 安装MySQL 8.0
```bash
# 下载安装包: https://dev.mysql.com/downloads/mysql/
# 选择 MySQL 8.0.x 版本

# 安装完成后，设置root密码
# 建议密码: 521314 (与配置文件一致)
```

#### 4. 安装Redis 6.0+
```bash
# Windows (使用Chocolatey)
choco install redis-64

# 或者下载: https://github.com/microsoftarchive/redis/releases

# 启动Redis
redis-server
```

#### 5. 安装Maven 3.6+
```bash
# Windows (使用Chocolatey)
choco install maven

# 验证安装
mvn -version
```

---

### 第二步：数据库配置

#### 1. 创建数据库
```sql
-- 连接MySQL
mysql -u root -p

-- 创建数据库
CREATE DATABASE tcmwr_db CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- 创建用户 (可选)
CREATE USER 'tcmwr'@'localhost' IDENTIFIED BY '521314';
GRANT ALL PRIVILEGES ON tcmwr_db.* TO 'tcmwr'@'localhost';
FLUSH PRIVILEGES;
```

#### 2. 导入表结构和数据
```bash
# 进入后端资源目录
cd backend/src/main/resources

# 连接数据库并执行
mysql -u root -p tcmwr_db < schema.sql
mysql -u root -p tcmwr_db < data.sql
```

**注意**: 如果使用H2内存数据库进行测试，可以跳过此步骤，系统会自动初始化。

---

### 第三步：后端部署

#### 1. 配置后端应用
编辑 `backend/src/main/resources/application.yml`:

```yaml
# 数据源配置 (生产环境使用MySQL)
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/tcmwr_db?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root          # 修改为你的MySQL用户名
    password: 521314        # 修改为你的MySQL密码
    driver-class-name: com.mysql.cj.jdbc.Driver

  # Redis配置
  data:
    redis:
      host: localhost
      port: 6379
      password: ''          # 如果Redis有密码，填写此处
      database: 0

# DeepSeek API配置 (必需)
deepseek:
  api-key: sk-xxxxxxxxxxxx  # 替换为你的DeepSeek API密钥
  base-url: https://api.deepseek.com
  timeout: 30000
  model: deepseek-v3
```

**获取DeepSeek API密钥**:
1. 访问 [DeepSeek官网](https://www.deepseek.com/)
2. 注册账号并登录
3. 进入API控制台创建API密钥
4. 将密钥填入配置文件

#### 2. 编译打包后端
```bash
cd backend

# 清理并打包 (跳过测试)
mvn clean package -DskipTests

# 编译成功后，在target目录生成: tcmwr-backend-1.0.0.jar
```

#### 3. 启动后端服务
```bash
cd backend

# 方式1: 使用Maven运行
mvn spring-boot:run

# 方式2: 使用JAR包运行
java -jar target/tcmwr-backend-1.0.0.jar

# 方式3: 指定配置文件运行
java -jar target/tcmwr-backend-1.0.0.jar --spring.profiles.active=prod
```

**验证后端服务**:
```bash
# 检查服务状态
curl http://localhost:8082/api/health

# 预期响应: {"status":"UP","timestamp":"..."}
```

---

### 第四步：前端部署

#### 1. 安装前端依赖
```bash
cd frontend

# 安装依赖
npm install

# 如果安装失败，可以使用淘宝镜像
npm install --registry=https://registry.npmmirror.com
```

#### 2. 配置前端代理
编辑 `frontend/vite.config.js` (通常无需修改):
```javascript
proxy: {
  '/api': {
    target: 'http://localhost:8082',  // 指向后端端口
    changeOrigin: true
  }
}
```

#### 3. 启动前端开发服务
```bash
cd frontend

# 启动开发服务器
npm run dev

# 预期输出:
# VITE v4.4.9  ready in XXX ms
# ➜  Local:   http://localhost:5173/
# ➜  Network: use --host to expose
```

#### 4. 构建生产版本 (可选)
```bash
cd frontend

# 构建生产版本
npm run build

# 输出目录: dist/
# 可以使用任何Web服务器部署
```

---

### 第五步：验证部署

#### 1. 检查所有服务状态
```bash
# 检查后端
curl http://localhost:8082/api/health

# 检查Redis
redis-cli ping
# 应返回: PONG

# 检查MySQL
mysql -u root -p -e "SHOW DATABASES LIKE 'tcmwr_db';"
```

#### 2. 访问系统
打开浏览器访问:
- **前端**: http://localhost:5173/
- **后端API**: http://localhost:8082/api

#### 3. 测试核心功能
1. **注册新用户**: 访问 http://localhost:5173/register
2. **用户登录**: 使用注册的账号登录
3. **添加健康数据**: 在健康监测页面记录数据
4. **获取AI建议**: 在智能推荐页面获取建议

---

## 🔍 常见问题排查

### 问题1: 后端启动失败 - 数据库连接错误
**症状**: `Communications link failure` 或 `Access denied`

**解决方案**:
```bash
# 1. 检查MySQL服务是否运行
services.msc | grep MySQL

# 2. 检查数据库配置
# 确认application.yml中的用户名密码正确

# 3. 检查防火墙
# 确保3306端口未被阻止

# 4. 重新创建数据库
mysql -u root -p -e "DROP DATABASE IF EXISTS tcmwr_db; CREATE DATABASE tcmwr_db;"
```

### 问题2: Redis连接失败
**症状**: `Connection refused` 或 `NOAUTH Authentication required`

**解决方案**:
```bash
# 1. 启动Redis服务
redis-server

# 2. 检查Redis端口
netstat -ano | findstr 6379

# 3. 如果有密码，配置到application.yml
spring.data.redis.password=your_redis_password
```

### 问题3: 前端无法连接后端
**症状**: `Network Error` 或 `502 Bad Gateway`

**解决方案**:
1. 检查后端是否正常运行: `curl http://localhost:8082/api/health`
2. 检查vite.config.js代理配置是否正确
3. 检查端口是否被占用: `netstat -ano | findstr 8082`
4. 重启前端开发服务器

### 问题4: DeepSeek API调用失败
**症状**: `401 Unauthorized` 或 `API key invalid`

**解决方案**:
1. 确认DeepSeek API密钥正确配置
2. 检查API密钥是否有余额
3. 验证网络连接是否正常
4. 检查application.yml中的配置格式

### 问题5: 端口被占用
**症状**: `Address already in use`

**解决方案**:
```bash
# 查找占用端口的进程
netstat -ano | findstr 8082  # 后端
netstat -ano | findstr 5173  # 前端

# 终止进程
taskkill /PID <进程ID> /F

# 或者修改端口
# 后端: 修改application.yml server.port
# 前端: 修改vite.config.js server.port
```

---

## 📊 系统配置说明

### 后端配置详解

#### 数据源配置
```yaml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/tcmwr_db?useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: 521314
    hikari:
      connection-timeout: 30000
      maximum-pool-size: 20
      minimum-idle: 5
```

#### Redis配置
```yaml
spring:
  data:
    redis:
      host: localhost
      port: 6379
      password: ''
      database: 0
      timeout: 5000ms
```

#### JWT配置
```yaml
jwt:
  secret: tcmwr_jwt_secret_key_2026
  expiration: 86400          # 24小时
  refresh-expiration: 604800 # 7天
```

#### DeepSeek API配置
```yaml
deepseek:
  api-key: sk-xxxxxxxxxxxx
  base-url: https://api.deepseek.com
  timeout: 30000
  model: deepseek-v3
```

### 前端配置详解

#### 开发服务器配置
```javascript
server: {
  port: 5173,
  host: true,
  proxy: {
    '/api': {
      target: 'http://localhost:8082',
      changeOrigin: true
    }
  }
}
```

#### 构建配置
```javascript
build: {
  outDir: 'dist',
  assetsDir: 'assets',
  sourcemap: false,
  rollupOptions: {
    output: {
      manualChunks: {
        vendor: ['vue', 'vue-router', 'pinia'],
        ui: ['element-plus'],
        charts: ['echarts', 'three'],
        axios: ['axios']
      }
    }
  }
}
```

---

## 🔐 安全配置

### 数据库安全
1. **修改默认密码**: 将MySQL和Redis的默认密码更改为强密码
2. **限制访问**: 仅允许本地访问数据库
3. **定期备份**: 设置自动备份策略

### API安全
1. **JWT密钥**: 使用强随机密钥，定期更换
2. **CORS配置**: 限制允许的源
3. **速率限制**: 防止API滥用

### 前端安全
1. **环境变量**: 敏感信息不硬编码
2. **HTTPS**: 生产环境使用HTTPS
3. **依赖更新**: 定期更新npm依赖

---

## 📈 性能优化建议

### 后端优化
1. **JVM参数**: 调整堆内存大小
   ```bash
   java -Xms512m -Xmx1024m -jar tcmwr-backend-1.0.0.jar
   ```

2. **数据库连接池**: 根据并发量调整大小
3. **Redis缓存**: 合理使用缓存策略
4. **日志级别**: 生产环境使用INFO或WARN

### 前端优化
1. **代码分割**: 利用Vite的自动代码分割
2. **图片压缩**: 使用WebP格式
3. **CDN**: 静态资源使用CDN加速
4. **Gzip压缩**: 启用服务器压缩

---

## 🔄 日常维护

### 启动顺序
```
1. 启动MySQL服务
2. 启动Redis服务
3. 启动后端服务
4. 启动前端服务
```

### 停止顺序
```
1. 停止前端服务 (Ctrl+C)
2. 停止后端服务 (Ctrl+C 或 kill进程)
3. 停止Redis服务
4. 停止MySQL服务
```

### 数据备份
```bash
# MySQL备份
mysqldump -u root -p tcmwr_db > tcmwr_backup_$(date +%Y%m%d).sql

# Redis备份 (如果使用持久化)
# Redis数据会自动保存到磁盘
```

---

## 📞 技术支持

### 获取帮助
1. **查看日志**: 检查控制台输出的错误信息
2. **检查配置**: 确认所有配置文件正确
3. **网络诊断**: 使用ping、telnet等工具测试连接

### 调试工具
- **Postman**: API接口测试
- **浏览器开发者工具**: 前端调试
- **Redis Desktop Manager**: Redis可视化
- **MySQL Workbench**: 数据库管理

---

## 🎉 部署成功检查清单

- [ ] JDK 17+ 已安装并配置
- [ ] Node.js 18+ 已安装并配置
- [ ] MySQL 8.0+ 已安装并运行
- [ ] Redis 6.0+ 已安装并运行
- [ ] Maven 已安装并配置
- [ ] 数据库 tcmwr_db 已创建
- [ ] 表结构和数据已导入
- [ ] DeepSeek API密钥已配置
- [ ] 后端编译成功
- [ ] 后端服务正常运行
- [ ] 前端依赖安装成功
- [ ] 前端服务正常运行
- [ ] 可以访问 http://localhost:5173/
- [ ] 可以成功注册/登录用户
- [ ] 可以记录健康数据
- [ ] 可以获取AI智能建议

---

## 📝 版本历史

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0.0 | 2026-01-15 | 初始版本，完整部署指南 |

---

**祝您部署成功！** 🚀

如有问题，请参考常见问题排查章节或联系技术支持。
